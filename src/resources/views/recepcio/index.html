<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="hotel-info">
    </div>
    <div id="calendar-container" class="calendar-grid">
        <!-- El calendari es carrega inicialment aquí -->
    </div>
    <div class="calendar-navigation">
        <button id="prev-7-days" class="nav-button">← 7 dies enrere</button>
        <button id="next-7-days" class="nav-button">7 dies endavant →</button>
    </div>
</body>
</html>

<script>
    const calendarContainer = document.getElementById('calendar-container');
    const baseUrl = "{{ route('recepcio') }}";
    let currentStartDate = "{{ now()->subDays(5)->toDateString() }}";

    function loadCalendar(startDate) {
        fetch(`${baseUrl}?start_date=${startDate}`)
            .then(response => response.json())
            .then(data => renderCalendar(data));
    }

    function renderCalendar(data) {
        const { startDate, endDate, habitacions, reservas } = data;

        // Genera els encapçalaments
        const headers = [];
        let currentDate = new Date(startDate);
        const endDateObj = new Date(endDate);

        while (currentDate <= endDateObj) {
            headers.push(
                `<div class="calendar-header" data-date="${currentDate.toISOString()}">
                    ${currentDate.toLocaleDateString('ca-ES', { day: '2-digit', month: 'short' })}
                </div>`
            );
            currentDate.setDate(currentDate.getDate() + 1);
        }

        // Genera les files per habitacions
        const rows = habitacions.map(habitacio => {
            const cells = [];
            currentDate = new Date(startDate);

            while (currentDate <= endDateObj) {
                const reserva = reservas.find(r =>
                    r.habitacion_id === habitacio.id &&
                    new Date(r.data_entrada) <= currentDate &&
                    new Date(r.data_sortida) > currentDate
                );

                if (reserva) {
                    const estancia = (new Date(reserva.data_sortida) - currentDate) / (1000 * 60 * 60 * 24);
                    cells.push(
                        `<div class="calendar-cell reserved" data-id="${reserva.id}" style="grid-column: span ${Math.min(estancia, headers.length - cells.length)}">
                            ${reserva.usuari.nom}
                        </div>`
                    );
                    currentDate.setDate(currentDate.getDate() + estancia - 1);
                } else {
                    cells.push(`<div class="calendar-cell available"></div>`);
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return `<div class="calendar-row" data-room-id="${habitacio.id}">
                        <div class="room-name">${habitacio.numHabitacion}</div>
                        ${cells.join('')}
                    </div>`;
        });

        calendarContainer.innerHTML = `
            <div class="calendar-header-row">${headers.join('')}</div>
            ${rows.join('')}
        `;
    }

    document.getElementById('prev-7-days').addEventListener('click', () => {
        currentStartDate = new Date(new Date(currentStartDate).setDate(new Date(currentStartDate).getDate() - 7)).toISOString().split('T')[0];
        loadCalendar(currentStartDate);
    });

    document.getElementById('next-7-days').addEventListener('click', () => {
        currentStartDate = new Date(new Date(currentStartDate).setDate(new Date(currentStartDate).getDate() + 7)).toISOString().split('T')[0];
        loadCalendar(currentStartDate);
    });

    // Carrega inicial
    loadCalendar(currentStartDate);
</script>


<style>
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(32, 1fr);
        gap: 1px;
        margin: 10px 0;
    }

    .calendar-header-row {
        display: contents;
    }

    .calendar-header {
        font-weight: bold;
        text-align: center;
        background: #ddd;
        padding: 5px;
    }

    .calendar-row {
        display: contents;
    }

    .calendar-cell {
        border: 1px solid #ccc;
        text-align: center;
        padding: 5px;
    }

    .reserved {
        background-color: #f88;
    }

    .available {
        background-color: #8f8;
    }

    .room-name {
        grid-column: span 1;
        font-weight: bold;
        text-align: center;
        background: #bbb;
    }
</style>
